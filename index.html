<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Global Tecnologia | Sistema Integrado</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
body{margin:0;font-family:Arial;background:#f4f6f9}
header{background:#0b5ed7;color:#fff;padding:15px;text-align:center}
.container{display:flex;height:calc(100vh - 60px)}
nav{width:240px;background:#fff;border-right:1px solid #ddd}
nav button{width:100%;padding:12px;border:none;background:#fff;text-align:left;cursor:pointer}
nav button:hover{background:#e9f0ff}
main{flex:1;padding:20px;overflow:auto}
.card{background:#fff;padding:15px;border-radius:10px;margin-bottom:15px}
table{width:100%;border-collapse:collapse}
td,th{border:1px solid #ccc;padding:6px;text-align:center}
button{padding:6px 10px;border:none;border-radius:6px}
.ac{background:#0b5ed7;color:#fff}
.del{background:#dc3545;color:#fff}
#login{position:fixed;inset:0;display:flex;align-items:center;justify-content:center}
</style>
</head>
<body>
<header><h2>GLOBAL TECNOLOGIA â€” SISTEMA FINANCEIRO</h2></header>

<div id="login">
<div class="card">
<input id="email" placeholder="Email">
<input id="senha" type="password" placeholder="Senha">
<button class="ac" onclick="entrar()">Entrar</button>
</div>
</div>

<div class="container" id="app" style="display:none">
<nav>
<button onclick="mostrar('dashboard')">ðŸ“Š Dashboard</button>
<button onclick="mostrar('custos')">ðŸ“¦ Controle de Custos</button>
<button onclick="sair()">ðŸšª Sair</button>
</nav>

<main>
<section id="dashboard"><div class="card">Dashboard preservado</div></section>

<section id="custos" style="display:none">
<div class="card">
<h3>Novo Registro Operacional</h3>
<input id="rc_desc" placeholder="DescriÃ§Ã£o">
<input id="rc_valor" type="number" placeholder="Valor">
<select id="rc_status"><option>Previsto</option><option>Pago</option></select>
<label><input type="checkbox" id="rc_integrar"> Integrar ao Financeiro</label>
<button class="ac" onclick="salvarRegistro()">Salvar</button>
</div>

<div class="card">
<table>
<thead>
<tr><th>DescriÃ§Ã£o</th><th>Valor</th><th>Status</th><th>AÃ§Ãµes</th></tr>
</thead>
<tbody id="listaCustos"></tbody>
</table>
</div>
</section>
</main>
</div>

<script>
const firebaseConfig={apiKey:"AIzaSyApCbQJCUQSwP0g6vSBqwrIMSK7n-w9ILc",authDomain:"global-tecnologia-kanban.firebaseapp.com",projectId:"global-tecnologia-kanban"};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth(),db=firebase.firestore();let uid=null;

auth.onAuthStateChanged(u=>{
 if(u){
  uid=u.uid;
  login.style.display="none";
  app.style.display="flex";
  carregarRegistros();
 }else{
  login.style.display="flex";
  app.style.display="none";
 }
});

function entrar(){auth.signInWithEmailAndPassword(email.value,senha.value);}
function sair(){auth.signOut();}
function mostrar(id){
 document.querySelectorAll("section").forEach(s=>s.style.display="none");
 document.getElementById(id).style.display="block";
}

async function salvarRegistro(){
 const r={descricao:rc_desc.value,valor:Number(rc_valor.value),status:rc_status.value};
 if(!r.descricao||!r.valor){alert("Preencha os campos");return;}
 await db.collection("usuarios").doc(uid).collection("registros_operacionais").add(r);
 carregarRegistros();
}

async function carregarRegistros(){
 listaCustos.innerHTML="";
 const snap=await db.collection("usuarios").doc(uid).collection("registros_operacionais").get();
 snap.forEach(d=>{
  const r=d.data();
  listaCustos.innerHTML+=`<tr>
   <td>${r.descricao}</td>
   <td>R$ ${r.valor.toFixed(2)}</td>
   <td>${r.status}</td>
   <td><button class="del" onclick="excluirRegistro('${d.id}')">Excluir</button></td>
  </tr>`;
 });
}

async function excluirRegistro(id){
 if(confirm("Excluir registro?")){
  await db.collection("usuarios").doc(uid).collection("registros_operacionais").doc(id).delete();
  carregarRegistros();
 }
}
</script>
</body>
</html>
